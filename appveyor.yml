image:
- Visual Studio 2015

environment:
  MSYS_ARCH: x86_64

build:
  verbosity: detailed
  
install:
    - ps: (new-object net.webclient).DownloadFile('https://github.com/electron/rcedit/releases/download/v0.1.0/rcedit.exe', "$pwd\rcedit.exe")

build_script:
- echo %PATH%
- set PATH=C:\msys64\usr\bin;C:\mingw-w64\x86_64-6.3.0-posix-seh-rt_v5-rev1\mingw64\bin;%PATH%
- set CC=gcc
- set MSYSTEM=MINGW64
- bash -lc "pwd"
- bash -lc "cd $APPVEYOR_BUILD_FOLDER && ./bootstrap"
- bash -lc "cd $APPVEYOR_BUILD_FOLDER && ./configure --enable-static --disable-shared --disable-drm --disable-randr --disable-vidmode --enable-wingdi --disable-quartz --disable-geoclue --disable-geoclue2 --disable-corelocation --disable-gui --disable-ubuntu --disable-nls --host=x86_64-w64-mingw32"
- bash -lc "cd $APPVEYOR_BUILD_FOLDER && make"

after_build:
- ps: .\rcedit.exe ./src/redshift.exe --set-icon ./data/icons/windows/redshift.ico
- cmd: >-
    7z a redshift.zip ./src/redshift.exe COPYING NEWS README.md

    appveyor PushArtifact redshift.zip
